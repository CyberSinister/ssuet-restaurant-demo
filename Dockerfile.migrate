# Dockerfile for database migrations
FROM node:20-alpine

WORKDIR /app

RUN apk add --no-cache libc6-compat openssl

# Copy package files and prisma
COPY package*.json ./
COPY prisma ./prisma/

# Install dependencies
RUN npm install --legacy-peer-deps

# Generate Prisma client
RUN npx prisma generate

# Run migrations and optional seed
CMD ["sh", "-c", "npx prisma db push --accept-data-loss && echo 'Migrations complete'"]
