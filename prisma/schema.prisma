// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Admin user model for authentication
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // hashed with bcrypt
  name      String?
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Category model for menu organization
model Category {
  id           String     @id @default(cuid())
  name         String
  description  String
  displayOrder Int
  active       Boolean    @default(true)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  menuItems    MenuItem[]

  @@index([displayOrder])
}

// Menu item model
model MenuItem {
  id           String      @id @default(cuid())
  name         String
  description  String
  price        Float
  categoryId   String
  category     Category    @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  image        String
  dietaryTags  String      // JSON string array
  available    Boolean     @default(true)
  isDeleted    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  orderItems   OrderItem[]

  @@index([categoryId])
  @@index([available])
}

// Customer model
model Customer {
  id                String   @id @default(cuid())
  name              String
  email             String   @unique
  password          String   // hashed with bcrypt
  phone             String
  address           String?
  isVerified        Boolean  @default(false)
  verificationToken String?
  resetToken        String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  orders            Order[]

  @@index([email])
  @@index([phone])
}

// Order model
model Order {
  id           String      @id @default(cuid())
  customerId   String
  customer     Customer    @relation(fields: [customerId], references: [id])
  orderType    String      // 'delivery' or 'pickup'
  status       String      @default("pending") // 'pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'
  address      String?
  subtotal     Float
  tax          Float
  total        Float
  notes        String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  orderItems   OrderItem[]

  @@index([customerId])
  @@index([status])
  @@index([createdAt])
}

// Order item model (items in an order)
model OrderItem {
  id                   String   @id @default(cuid())
  orderId              String
  order                Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menuItemId           String
  menuItem             MenuItem @relation(fields: [menuItemId], references: [id])
  quantity             Int
  price                Float    // Price at time of order
  specialInstructions  String?
  createdAt            DateTime @default(now())

  @@index([orderId])
  @@index([menuItemId])
}

// Restaurant settings model (singleton)
model RestaurantSettings {
  id           String   @id @default(cuid())
  name         String
  phone        String
  email        String
  address      String
  hours        String   // JSON string of hours object
  deliveryFee  Float
  minimumOrder Float
  taxRate      Float
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// SMTP configuration model (encrypted credentials)
model SMTPConfig {
  id        String   @id @default(cuid())
  host      String
  port      Int
  secure    Boolean  @default(true)
  username  String
  password  String   // encrypted
  fromEmail String
  fromName  String
  enabled   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Restaurant Location model
model Location {
  id          String   @id @default(cuid())
  name        String
  address     String
  city        String
  country     String
  phone       String?
  email       String?
  image         String?
  countryImages String?  // JSON string array of image URLs
  cityImages    String?  // JSON string array of image URLs
  latitude    Float?
  longitude   Float?
  hours       String?  // JSON string of hours
  active      Boolean  @default(true)
  slug        String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([city])
  @@index([country])
}

// Branding / Theme Configuration
model BrandingConfig {
  id              String   @id @default("default") // Singleton ID
  
  // Logos
  logoUrl         String   @default("")
  mobileLogoUrl   String   @default("")
  logoAlt         String   @default("Broadway Pizza")
  faviconUrl      String   @default("")
  
  // Colors
  primaryColor    String   @default("#16a34a")
  secondaryColor  String   @default("#0d9488")
  accentColor     String   @default("#eab308")
  backgroundColor String   @default("#ffffff")
  foregroundColor String   @default("#0f172a")
  mutedColor      String   @default("#f1f5f9")
  cardColor       String   @default("#ffffff")
  
  // Typography
  fontFamily      String   @default("inter")
  headingFont     String   @default("poppins")
  
  // UI Settings
  borderRadius    String   @default("medium")
  darkMode        Boolean  @default(false)
  
  updatedAt       DateTime @updatedAt
}
