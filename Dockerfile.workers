# Dockerfile for BullMQ Workers
FROM node:20-alpine

WORKDIR /app

RUN apk add --no-cache libc6-compat openssl

# Copy package files
COPY package*.json ./
COPY prisma ./prisma/

# Install dependencies
RUN npm install --legacy-peer-deps

# Generate Prisma client
RUN npx prisma generate

# Copy worker files
COPY lib ./lib
COPY tsconfig.json ./

# Run workers
CMD ["npx", "tsx", "lib/jobs/workers.ts"]
